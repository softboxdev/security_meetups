https://docs.google.com/document/d/1T15Uwq4J7Y2mISzWA1WMHSY8agCuXFDqK4y7nlAGX04/edit?usp=sharing


### **Задание 1: Построение диаграммы потоков данных (DFD) для системы ProjectFlow**

DFD позволяет наглядно отобразить, какие данные обрабатываются в системе, кто их использует и куда они передаются. Это основа для выявления угроз и определения необходимых мер контроля.

---

### **1. Контекстная диаграмма (Уровень 0)**

Контекстная диаграмма отображает систему "ProjectFlow" как единый процесс и ее взаимодействие с внешними сущностями.

**Схема:**

```mermaid
flowchart TD
    subgraph A [Внешние сущности]
        direction LR
        A1[Сотрудник]
        A2[Администратор]
        A3[Клиент<br>внешний]
        A4[Внешние сервисы]
    end

    B(ProjectFlow<br>Система управления проектами)

    A1 -- Запросы, данные,<br>уведомления --> B
    A2 -- Настройки,<br>управление доступом, отчеты --> B
    A3 -- Запросы,<br>фидбэк --> B
    A4 -- СМС, Email,<br>резервные копии --> B
```

**Пояснительная записка к контекстной диаграмме (Уровень 0):**

*   **Центральный процесс (1):**
    *   **ProjectFlow (Система управления проектами):** Единая система, представляющая собой весь функционал приложения.

*   **Внешние сущности:**
    *   **Сотрудник:** Пользователь системы (разработчик, менеджер, аналитик). Инициирует основные потоки данных: запросы на выполнение операций, загрузку/скачивание данных, получение уведомлений.
    *   **Администратор:** Сотрудник с повышенными привилегиями. Обеспечивает функционирование системы: настройку, управление пользователями и правами доступа, формирование отчетов.
    *   **Клиент (внешний):** Внешняя организация-заказчик. Может иметь ограниченный доступ к системе для просмотра статуса проектов, обмена документацией и оставления обратной связи.
    *   **Внешние сервисы:** Сторонние системы, интегрируемые с ProjectFlow для обеспечения функциональности. Например:
        *   Сервисы Email и SMS для рассылки уведомлений.
        *   Облачные хранилища (с российскими ЦОД) для резервного копирования.

*   **Ключевые потоки данных:**
    *   Потоки от пользователей к системе: это **команды и данные** (логин, загрузка файла, создание задачи).
    *   Потоки от системы к пользователям: это **ответы и уведомления** (интерфейс приложения, отчет, email-оповещение).
    *   Потоки с внешними сервисами: это **интеграционные обмены** (отправка запроса на API SMS-шлюза, выгрузка бэкапа в облако).

---

### **2. Диаграмма уровня 1**

Диаграмма уровня 1 детализирует центральный процесс, показывая основные подпроцессы и накопители данных внутри системы.

**Схема:**

```mermaid
flowchart TD
    subgraph A [Внешние сущности]
        A1[Сотрудник]
        A2[Администратор]
        A3[Клиент]
        A4[Внешние сервисы<br>Email, SMS, Облако]
    end

    subgraph B [Процессы ProjectFlow]
        direction TB
        B1[Аутентификация<br>и авторизация]
        B2[Управление<br>проектами и задачами]
        B3[Работа с<br>документами и кодом]
        B4[Коммуникации<br>и уведомления]
        B5[Аналитика<br>и отчетность]
        B6[Администрирование<br>системы]
    end

    subgraph C [Накопители данных]
        C1[База данных<br>пользователей и сессий]
        C2[База данных<br>проектов и задач]
        C3[Файловое<br>хранилище<br>Документы, Исходный код]
        C4[База данных<br>коммуникаций]
    end

    A1 -- Учетные данные,<br>действия --> B1
    A1 -- Запросы по проектам,<br>задачи --> B2
    A1 -- Запросы на загрузку<br>и скачивание --> B3
    A1 -- Сообщения, запросы --> B4

    A2 -- Команды управления --> B6

    A3 -- Запросы на статус<br>проекта --> B2
    A3 -- Фидбэк --> B4

    B1 -- Проверка учетных данных<br>и прав --> C1
    B1 -- Успешная аутентификация<br>токен сессии --> A1

    B2 -- Чтение/запись<br>данных проекта --> C2
    B2 -- Ссылки на файлы --> C3

    B3 -- Чтение/запись<br>метаданных --> C2
    B3 -- Чтение/запись файлов --> C3

    B4 -- Чтение/запись<br>сообщений --> C4
    B4 -- Запрос на отправку<br>уведомления --> A4
    A4 -- Статус отправки --> B4

    B5 -- Аналитические запросы<br>к данным --> C2 & C4
    B5 -- Отчеты, дашборды --> A1 & A2

    B6 -- Управление<br>пользователями --> C1
    B6 -- Управление<br>системными настройками --> C2
    B6 -- Формирование<br>отчетов аудита --> C1 & C2 & C4
    B6 -- Запрос на<br>резервное копирование --> A4
```

**Пояснительная записка к диаграмме уровня 1:**

*   **Процессы (функциональные модули):**
    1.  **Аутентификация и авторизация:** Критический процесс контроля доступа. Проверяет личность пользователя и определяет его права в системе.
    2.  **Управление проектами и задачами:** Ядро системы. Обрабатывает создание, редактирование, отслеживание проектов, задач и их статусов.
    3.  **Работа с документами и кодом:** Управляет жизненным циклом файлов (документы, исходный код): загрузка, версионирование, скачивание.
    4.  **Коммуникации и уведомления:** Обеспечивает обмен сообщениями между пользователями и интеграцию с внешними каналами (email, SMS) для оповещений.
    5.  **Аналитика и отчетность:** Формирует сводные данные, дашборды и отчеты на основе информации из других процессов.
    6.  **Администрирование системы:** Процесс для администраторов, включающий управление пользователями, настройками системы, мониторинг и формирование отчетов аудита.

*   **Накопители данных:**
    *   **База данных пользователей и сессий:** Хранит учетные записи, хэши паролей, роли, активные сессии. Это ключевой объект для защиты (152-ФЗ).
    *   **База данных проектов и задач:** Хранит структурированные данные: описание проектов, задачи, статусы, связи, метаданные файлов.
    *   **Файловое хранилище:** Хранит бинарные данные — документы (договоры, ТЗ) и исходный код. Это самые ценные активы компании, требующие строгого контроля доступа и шифрования.
    *   **База данных коммуникаций:** Хранит историю переписки, комментарии к задачам, уведомления.

*   **Уточненные потоки данных:**
    *   Потоки между процессами и накопителями показывают, какой процесс с какими данными работает (например, "Запись файла" от Процесса 3 к Хранилищу 3).
    *   Появление **токена сессии** как потока от Процесса 1 к Сотруднику — это важный элемент безопасности, заменяющий передачу пароля при каждом запросе.
    *   Поток **"Запрос на отправку уведомления"** от Процесса 4 к Внешним сервисам детализирует интеграцию.

### **Выводы для этапа проектирования защиты**

На основе построенных DFD уже можно сделать первые выводы для security-архитектуры:

1.  **Критичные точки:**
    *   **Процесс 1 (Аутентификация):** Требует усиленной защиты (МФА, контроль аномалий).
    *   **Накопители 1, 2, 3:** Хранят конфиденциальную информацию и персональные данные. Необходимо шифрование (как хранимых данных, так и каналов передачи), строгий контроль доступа и мониторинг операций.
    *   **Потоки между пользователем и системой:** Требуется защищенный протокол (HTTPS/TLS).

2.  **Учет российского регулирования:**
    *   Для хранения персональных данных сотрудников и, возможно, клиентов (если они физ. лица) необходимо обеспечить соответствие **152-ФЗ**. Это влияет на выбор серверов (российские ЦОД), политики хранения и обработки.
    *   Если система будет использоваться для проектов госзаказчиков, необходимо заложить возможность выполнения требований **ФСТЭК России**.

3.  **Следующие шаги:**
    *   На основе DFD необходимо провести **анализ угроз** (например, с помощью методологии STRIDE) для каждого элемента диаграммы.
    *   Разработать **модель угроз**.
    *   Спроектировать **архитектуру безопасности**, включая конкретные механизмы защиты (межсетевые экраны, SIEM, DLP, криптография) для выявленных уязвимых мест.


### **Задание 2: Анализ угроз с использованием STRIDE**

**Обоснование:** Анализ проводится для каждого элемента DFD уровня 1. Вероятность и влияние оцениваются по 3-балльной шкале (Низкая, Средняя, Высокая) с учетом контекста компании "ТехноПрогресс" (гибридная инфраструктура, ценные активы).

---

### **Матрица анализа угроз**

| Элемент DFD | Категория STRIDE | Описание угрозы | Вероятность | Влияние | Обоснование |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **1. Процесс "Аутентификация и авторизация"** | **Spoofing (Подмена)** | Злоумышленник крадет или подбирает учетные данные сотрудника для получения доступа к системе. | Высокая | Высокое | Использование стандартных паролей, фишинг-атаки на сотрудников. Доступ ко всей системе. |
| | **Tampering (Изменение)** | Изменение конфигурации политик авторизации для ослабления контроля доступа. | Средняя | Критическое | Требует доступа админа, но возможно через уязвимость в коде или инсайдера. |
| | **Repudiation (Отказ)** | Пользователь отрицает выполнение действий в системе (e.g., удаление файла). Аудит не ведется. | Средняя | Среднее | Без надлежащего логирования невозможно доказать действие. |
| | **Information Disclosure (Раскрытие)** | Утечка хэшей паролей или токенов сессий из БД или памяти процесса. | Средняя | Высокое | Позволяет захватить учетные записи. Критично для соблюдения 152-ФЗ. |
| | **Denial of Service (Отказ в обслуживании)** | "Атака" неправильными паролями, вызывающая блокировку учетных записей множества пользователей. | Средняя | Высокое | Нарушает бизнес-процессы компании. |
| | **Elevation of Privilege (Повышение привилегий)** | Обход проверок авторизации (e.g., из-за SQL-инъекции) для получения прав администратора. | Средняя | Критическое | Позволяет получить полный контроль над системой и данными. |
| **2. Процесс "Управление проектами и задачами"** | **Tampering (Изменение)** | Злоумышленник изменяет сроки, бюджет, статус проекта, что приводит к финансовым потерям. | Средняя | Высокое | Нарушение целостности бизнес-данных. |
| | **Information Disclosure (Раскрытие)** | Неавторизованный доступ к списку всех проектов и клиентов (коммерческая тайна). | Высокая | Критическое | Утечка стратегической информации конкурентам. |
| **3. Процесс "Работа с документами и кодом"** | **Tampering (Изменение)** | Внесение вредоносного кода в репозиторий или изменение критичной документации (ТЗ, договоры). | Средняя | Критическое | Прямая угроза интеллектуальной собственности и качеству продукта. |
| | **Information Disclosure (Раскрытие)** | Несанкционированное скачивание исходного кода или конфиденциальных документов клиента. | Высокая | Критическое | Потеря конкурентного преимущества, нарушение контрактов и 152-ФЗ. |
| **4. Процесс "Коммуникации и уведомления"** | **Information Disclosure (Раскрытие)** | Перехват конфиденциальных сообщений между сотрудниками или с клиентом по незащищенному каналу. | Средняя | Высокое | Утечка служебной и коммерческой информации. |
| | **Repudiation (Отказ)** | Отправка оскорбительного сообщения с последующим отрицанием этого факта. | Низкая | Среднее | Создает конфликтные ситуации внутри коллектива и с клиентами. |
| **5. Процесс "Администрирование системы"** | **Elevation of Privilege (Повышение)** | Обычный пользователь получает доступ к интерфейсу администрирования из-за ошибки контроля доступа. | Средняя | Критическое | Получение полного контроля над системой. |
| **6. Накопитель "База данных пользователей"** | **Tampering (Изменение)** | Прямой доступ к БД и изменение ролей пользователей или прав доступа. | Средняя | Критическое | Нарушение всей модели разграничения доступа. |
| | **Information Disclosure (Раскрытие)** | Кража таблицы с хэшами паролей и персональными данными сотрудников (e-mail, ФИО). | Высокая | Критическое | Прямое нарушение 152-ФЗ, компрометация всех учетных записей. |
| **7. Накопитель "Файловое хранилище"** | **Information Disclosure (Раскрытие)** | Прямой доступ к файловому серверу в обход приложения и скачивание исходных кодов. | Средняя | Критическое | Прямая угроза ключевым активам компании. |
| **8. Поток данных "Учетные данные"** | **Spoofing (Подмена)** | Перехват логина и пароля при передаче по незашифрованному каналу (HTTP). | Высокая | Высокое | Позволяет полностью захватить учетную запись пользователя. |
| **9. Внешняя сущность "Внешние сервисы"** | **Tampering (Изменение)** | Компрометация сервиса отправки Email и рассылка фишинговых писем от имени компании. | Средняя | Высокое | Подрыв репутации, компрометация сотрудников. |

---

### **Ключевые выводы и приоритеты для безопасности**

На основе проведенного анализа можно сформулировать четкие требования к системе защиты:

1.  **Высший приоритет (Критическое влияние):**
    *   **Защита исходного кода и документов:** Необходимо внедрить строгое разграничение доступа (на основе ролей), шифрование данных на уровне хранилища и журналирование всех операций доступа.
    *   **Защита персональных данных:** Для соответствия 152-ФЗ требуется шифрование БД пользователей, pseudonymization, и строгий контроль доступа.
    *   **Контроль целостности системы:** Внедрение подписей кода и механизмов контроля целостности файлов для предотвращения tampering.
    *   **Неотклоняемое логирование:** Централизованный сбор и защита логов всех критичных действий (аутентификация, доступ к файлам, изменения прав) для предотвращения repudiation и расследования инцидентов.

2.  **Средний приоритет (Высокое влияние):**
    *   **Усиленная аутентификация:** Внедрение **Многофакторной аутентификации (МФА/MFA)**, особенно для администраторов и доступа к критичным данным.
    *   **Защита каналов связи:** Обязательное использование TLS 1.2+ для всех соединений, как внутренних, так и с внешними сервисами.
    *   **Защита от DoS:** Использование WAF (Web Application Firewall) и ограничение частоты запросов к критичным endpoint'ам (логин, загрузка файлов).

3.  **Общие меры:**
    *   **Принцип минимальных привилегий:** Пользователи должны иметь доступ только к тем данным и функциям, которые необходимы для их работы.
    *   **Регулярный аудит безопасности:** Проведение пентестов и анализа уязвимостей, особенно для компонентов, доступных извне.
    *   **Security Awareness:** Обучение сотрудников правилам кибергигиены для противодействия фишингу и спуфингу.

Данный анализ является основой для следующего этапа — проектирования архитектуры безопасности и выбора конкретных контрмер (межсетевые экраны, SIEM, DLP, Vault).


### **Задание 3: Оценка рисков с использованием DREAD**

**Методика оценки:** Каждому параметру DREAD присваивается оценка от 0 до 5 баллов. Общий показатель риска вычисляется как среднее арифметическое всех пяти параметров.
`DREAD = (D + R + E + A + D) / 5`

---

### **Матрица оценки рисков по методике DREAD**

| Угроза (из задания 2) | **D**<br>Ущерб | **R**<br>Воспроиз-<br>водимость | **E**<br>Эксплуати-<br>руемость | **A**<br>Затронутые<br>пользователи | **D**<br>Обнаружа-<br>емость | **Средний<br>балл** | **Уровень<br>риска** |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **1. Information Disclosure:** Несанкционированное скачивание исходного кода (Процесс "Работа с документами и кодом") | **5**<br>Полная потеря ИС, ущерб репутации, судебные иски | **4**<br>Доступ можно получать многократно | **3**<br>Требуется учетная запись сотрудника (инсайдер) или уязвимость в системе контроля доступа | **3**<br>Затронута вся компания (потеря актива) и клиенты (нарушение конфиденциальности) | **4**<br>Злоумышленник может легко обнаружить уязвимости контроля доступа | **3.8** | **Высокий** |
| **2. Information Disclosure:** Кража таблицы с хэшами паролей и персональными данными сотрудников (Накопитель "БД пользователей") | **5**<br>Нарушение 152-ФЗ, штрафы, компрометация всех учетных записей | **5**<br>После получения досканать данные можно многократно | **2**<br>Требуется уязвимость, позволяющая прямой доступ к БД (напр., SQL-инъекция) | **5**<br>Затронуты абсолютно все сотрудники (200 человек) | **4**<br>Уязвимости типа SQLi хорошо известны и легко обнаруживаются сканерами | **4.2** | **Критический** |
| **3. Elevation of Privilege:** Обход проверок авторизации для получения прав администратора (Процесс "Аутентификация и авторизация") | **5**<br>Полный контроль над системой и данными | **4**<br>После обнаружения уязвимости ее можно эксплуатировать постоянно | **2**<br>Требуется высокая квалификация для поиска уязвимости в коде | **5**<br>Под угрозой вся система и все пользователи | **3**<br>Логические уязвимости сложно обнаружить автоматически | **3.8** | **Высокий** |
| **4. Tampering:** Внесение вредоносного кода в репозиторий (Процесс "Работа с документами и кодом") | **5**<br>Подрыв качества продукта, внедрение бэкдоров, компрометация клиентов | **3**<br>После внесения изменение может быть обнаружено системами контроля версий | **3**<br>Требуется учетная запись с правами на запись или уязвимость | **5**<br>Затронуты все клиенты, использующие данный код | **2**<br>Сложно обнаружить без анализа кода и ревью | **3.6** | **Высокий** |
| **5. Spoofing:** Подмена учетных данных пользователя (Процесс "Аутентификация и авторизация") | **4**<br>Получение доступа ко всем данным жертвы, совершение действий от ее имени | **5**<br>Атаку можно проводить многократно против разных пользователей | **4**<br>Фишинг или брутфорс не требуют глубоких технических знаний | **4**<br>Любой сотрудник может стать жертвой | **5**<br>Учетные данные передаются постоянно, вектор атаки очевиден | **4.4** | **Критический** |

---

### **Приоритизация рисков и рекомендации по контрмерам**

На основе оценки DREAD риски распределяются в следующий порядок приоритетности для устранения:

**1. Критический риск: Угроза №5 (Spoofing - Подмена учетных данных)**
*   **Риск:** 4.4
*   **Рекомендуемые контрмеры:**
    *   **Обязательное внедрение Многофакторной аутентификации (МФА/MFA)** для всех пользователей.
    *   Реализация политики **сложных паролей** и их регулярная смена.
    *   Проведение **регулярного обучения** сотрудников по теме фишинга и социальной инженерии.
    *   Внедрение системы обнаружения аномальных входов (например, вход из незнакомого местоположения).

**2. Критический риск: Угроза №2 (Information Disclosure - Кража БД пользователей)**
*   **Риск:** 4.2
*   **Рекомендуемые контрмеры:**
    *   **Хэширование паролей** с использованием стойких алгоритмов (bcrypt, Argon2) с **"солью"**.
    *   **Шифрование** полей с персональными данными в базе данных.
    *   Регулярный **аудит кода и пентесты** на наличие уязвимостей (SQL-инъекции).
    *   Строгое **разграничение доступа** к БД, использование принципа минимальных привилегий.

**3. Высокий риск: Угроза №1 (Information Disclosure - Утечка исходного кода)**
*   **Риск:** 3.8
*   **Рекомендуемые контрмеры:**
    *   Внедрение **системы контроля доступа на основе ролей (RBAC)** с детализированными разрешениями.
    *   **Шифрование файлового хранилища** на уровне дисков и/или приложения.
    *   **Неотклоняемое логирование** всех операций доступа к файлам (кто, когда, что скачал).

**4. Высокий риск: Угроза №3 (Elevation of Privilege - Повышение привилегий)**
*   **Риск:** 3.8
*   **Рекомендуемые контрмеры:**
    *   **Строгий код-ревью** всех компонентов, отвечающих за авторизацию.
    *   **Регулярное проведение пентестов** с фокусом на логику приложения.
    *   Принцип **минимальных привилегий** для сервисных учетных записей и компонентов системы.

**5. Высокий риск: Угроза №4 (Tampering - Изменение кода)**
*   **Риск:** 3.6
*   **Рекомендуемые контрмеры:**
    *   Внедрение процедуры **обязательного ревью кода** перед слиянием в основную ветку.
    *   Использование **подписанных коммитов** в системе контроля версий.
    *   Настройка **оповещений** о прямых пушах в главные ветки.

### **Общий вывод**

Методика DREAD наглядно показала, что наибольшую непосредственную опасность представляют угрозы, связанные с компрометацией учетных записей (Spoofing) и утечкой аутентификационных данных (Information Disclosure в БД пользователей). Это подтверждает необходимость первоочередных инвестиций в **усиление аутентификации (МФА) и защиту данных на уровне хранилищ (шифрование)**. Все выявленные высокие и критические риски требуют обязательного включения соответствующих контрмер в план проекта по внедрению системы ProjectFlow.

На основе проведенного анализа угроз и рисков переходим к ключевому этапу — проектированию системы защиты, которая будет встроена в архитектуру "ProjectFlow" с учетом российских требований.

### **Задание 4: Выявление уязвимостей на этапе проектирования и проектирование контрмер**

---

### **Часть 1: Ключевые архитектурные решения**

#### **1.1. Схема аутентификации и авторизации**

**Архитектурное решение:** Многоуровневая система контроля доступа на основе ролей (RBAC) с обязательной многофакторной аутентификацией (MFA).

*   **Аутентификация:**
    1.  **Единая точка входа (SSO):** Интеграция с российским сервисом единого входа (например, на базе **OpenID Connect**), если в компании есть корпоративный портал. Если нет — собственная реализация OAuth 2.0/OpenID Connect.
    2.  **Многофакторная аутентификация (MFA):** Обязательное использование второго фактора для всех пользователей. В качестве фактора использовать **TOTP-приложение** (например, Google Authenticator или Яндекс.Ключ) или **SMS** (менее предпочтительно из-за рисков SIM-свопинга). Для администраторов — только TOTP или аппаратные ключи.
    3.  **Управление сессиями:** Использование короткоживущих JWT-токенов (access token) и долгоживущих refresh-токенов. Refresh-токены хранятся в защищенном хранилище (httpOnly cookie) и отзываются.

*   **Авторизация:**
    1.  **Ролевая модель (RBAC):** Определены роли (`Пользователь`, `Менеджер`, `Администратор`, `Клиент_внешний`). Права назначаются ролям, а не пользователям.
    2.  **Проверка прав на каждом уровне:**
        *   **Уровень представления:** В интерфейсе отображаются только доступные для роли функции.
        *   **Уровень контроллера (Backend):** Все API-эндпоинты защищены аннотациями/декораторами, проверяющими права доступа (например, `@PreAuthorize("hasRole('MANAGER')")`).
        *   **Уровень сервиса (Backend):** Бизнес-логика включает дополнительные проверки, что пользователь имеет доступ именно к данной сущности (например, к проекту Х, а не ко всем проектам).

**Обоснование:** Данная схема напрямую противостоит угрозам **Spoofing** и **Elevation of Privilege**, значительно усложняя компрометацию учетной записи и несанкционированный доступ.

#### **1.2. Модель управления доступом**

**Архитектурное решение:** Комбинированная модель **RBAC + ABAC (Attribute-Based Access Control)** для детализированного контроля.

*   **RBAC:** Определяет, *что* пользователь может делать в системе (создавать проекты, читать задачи).
*   **ABAC:** Определяет, *к каким конкретным данным* пользователь имеет доступ. Правила основаны на атрибутах:
    *   Атрибут пользователя: `Отдел`, `Команда`.
    *   Атрибут ресурса: `Владелец_проекта`, `Метка_конфиденциальности`.
    *   Правило: "Разработчик из `Команды_А` может читать исходный код только проектов, где `Владелец_проекта == Команда_А`".

**Обоснование:** Позволяет реализовать принцип минимальных привилегий, предотвращая угрозы **Information Disclosure** и **Tampering** на уровне данных, а не только функций.

#### **1.3. Схема защиты данных**

**Архитектурное решение:** Сквозное шифрование и сегментация данных.

*   **Шифрование в состоянии покоя:**
    1.  **Базы данных:** Использование прозрачного шифрования дисков (например, LUKS в Linux) для всех данных. Для персональных данных и паролей — дополнительное **прикладное шифрование** с использованием российских криптографических алгоритмов (ГОСТ 34.12-2015 "Кузнечик") и ключей, хранящихся в **HashiCorp Vault** или российском аналоге.
    2.  **Файловое хранилище:** Шифрование на уровне блочного хранилища. Для исходного кода и критичных документов — дополнительное шифрование на уровне приложения перед записью в хранилище.

*   **Шифрование в состоянии передачи:**
    *   Обязательное использование **TLS 1.2+** для всего HTTP-трафика. Все внутренние сервисы взаимодействуют по защищенным каналам (mTLS).

*   **Сегментация данных:**
    *   Разделение БД и файловых хранилищ для разных типов данных (пользователи, проекты, файлы) на разные логические/физические серверы или инстансы. Доступ к каждому сегменту ограничивается сетевыми политиками.

**Обоснование:** Прямая защита от угроз **Information Disclosure** даже в случае компрометации хранилища или перехвата трафика. Обеспечивает соответствие 152-ФЗ.

#### **1.4. Архитектура мониторинга безопасности**

**Архитектурное решение:** Централизованный сбор логов и система реагирования на инциденты (SIEM).

*   **Сбор данных:** Все компоненты (веб-серверы, приложение, БД, СУБД) направляют логи в центральную систему (например, на базе **ELK Stack** или **Splunk**).
*   **Ключевые события для мониторинга:**
    *   Неудачные попытки входа.
    *   Попытки доступа к запрещенным ресурсам (403 ошибки).
    *   Массовое скачивание или выгрузка файлов.
    *   Изменения в правах доступа пользователей.
    *   Доступ к интерфейсам администрирования.
*   **Автоматизация реагирования:** Настройка правил корреляции для генерации оповещений (например, "10 неудачных логинов за 1 минуту" -> блокировка IP в WAF; "Вход пользователя из Москвы, а через 5 минут из Владивостока" -> оповещение SOC).

**Обоснование:** Позволяет выявлять и оперативно реагировать на атаки (**DoS, Spoofing, Information Disclosure**), а также обеспечивает **неотклоняемое логирование** для расследования инцидентов и противодействия **Repudiation**.

---

### **Часть 2: Контрмеры для критичных угроз из задания 3**

| Критичная угроза | Технические контрмеры | Организационные меры | Процедуры мониторинга |
| :--- | :--- | :--- | :--- |
| **1. Spoofing (Подмена учетных данных)** | 1. **Внедрение MFA** для всех учетных записей.<br>2. **Политика сложных паролей** (мин. 12 символов, все категории).<br>3. **Блокировка учетной записи** после 5 неудачных попыток входа. | 1. **Обязательное обучение** по кибергигиене и фишингу.<br>2. **Регламент смены паролей** при подозрении на компрометацию. | 1. **Мониторинг аномалий входа:** геолокация, время, устройство.<br>2. **Аналитики в SIEM** для обнаружения брутфорс-атак. |
| **2. Information Disclosure (Кража БД пользователей)** | 1. **Хэширование паролей** алгоритмом **bcrypt** (стойкость 12).<br>2. **Шифрование** полей с ПДн (ФИО, email) в БД.<br>3. **Защита от SQL-инъекций:** использование ORM/prepared statements, регулярные пентесты. | 1. **Регламент обработки ПДн** в соответствии с 152-ФЗ.<br>2. **Разделение обязанностей:** доступ к продовой БД имеют только 2-3 ответственных администратора. | 1. **Мониторинг всех запросов** к БД с выделением аномальных (большие выборки, нестандартные запросы).<br>2. **Аудит доступа** к серверам БД. |
| **3. Information Disclosure (Утечка исходного кода)** | 1. **Детализированная модель RBAC+ABAC** для репозиториев.<br>2. **Шифрование файлового хранилища** на уровне приложения.<br>3. **WAF** для блокировки попыток скачивания по нестандартным путям. | 1. **Политика разграничения доступа** к проектам.<br>2. **Обязательный код-ревью** перед слиянием в главную ветку. | 1. **Логирование всех операций** с файлами (кто, что, когда скачал).<br>2. **Оповещения на массовое скачивание** (>50 файлов за 10 мин). |
| **4. Elevation of Privilege** | 1. **Строгая валидация прав на уровне backend** для каждого API-вызова.<br>2. **Регулярное обновление и сканирование зависимостей** (SAST) на уязвимости.<br>3. **Минимальные привилегии** для сервисных учетных записей. | 1. **Процедура код-ревью** с фокусом на безопасность.<br>2. **Проведение внутренних пентестов** не реже 2 раз в год. | 1. **Мониторинг попыток доступа** к эндпоинтам `/admin`, `/api/settings`.<br>2. **Оповещения о назначении** пользователям ролей `Администратор`. |
| **5. Tampering (Изменение кода)** | 1. **Система контроля версий** (Git) с запретом прямого пуша в `main`.<br>2. **Цифровая подпись коммитов.**<br>3. **CI/CD пайплайн** с этапами статического анализа кода (SAST) и проверки подписи. | 1. **Регламент разработки,** требующий 2 approval перед мержем.<br>2. **Политика "четыре глаза"** для развертывания в прод. | 1. **Мониторинг активности в Git** (принудительные пуши, удаление веток).<br>2. **Оповещения о сборке и деплое** из неподписанного кода. |

### **Итоговый вывод**

Предложенный набор архитектурных решений и контрмер формирует целостную систему защиты информации для "ProjectFlow". Ключевые принципы: **"Не доверяй, проверяй"** (Zero Trust в упрощенной форме), **глубокоэшелонированная оборона** (Defense in Depth) и **встроенная безопасность** (Security by Design). Реализация этих мер позволит компании "ТехноПрогресс" не только противостоять выявленным угрозам, но и создать устойчивую к эволюции угроз платформу, соответствующую требованиям российского законодательства.



### **Задание 5: Разработка требований безопасности**

---

### **Требования безопасности для системы ProjectFlow**

**Цель:** Обеспечить встроенную безопасность на всех этапах жизненного цикла разработки системы (SDLC). Все требования являются обязательными к реализации.

---

#### **1. Аутентификация и управление доступом**

**1.1. Требование:** Реализовать многофакторную аутентификацию (MFA) для всех пользовательских учетных записей.
*   **Критерий приемки:** Система блокирует вход после ввода корректного пароля до успешного ввода одноразового кода из TOTP-приложения (например, Google Authenticator). Для административных учетных записей отключение MFA невозможно.

**1.2. Требование:** Пароли пользователей должны храниться в виде стойких хэшей.
*   **Критерий приемки:** В базе данных вместо паролей хранятся только хэши, сгенерированные алгоритмом **bcrypt** с фактором стоимости не менее **12**. Проверка хэширования осуществляется в тестовой среде.

**1.3. Требование:** Реализовать ролевую модель управления доступом (RBAC) с проверкой прав на уровне backend.
*   **Критерий приемки:** Для каждой роли (`user`, `manager`, `admin`) определен четкий список разрешений (CRUD) для всех сущностей системы. Прямой доступ к API-эндпоинтам без проверки роли в коде сервиса невозможен. Автотесты проверяют, что пользователь с ролью `user` не может получить доступ к эндпоинтам, предназначенным для `admin`.

**1.4. Требование:** Сессии пользователей должны быть защищены от перехвата и должны иметь ограниченное время жизни.
*   **Критерий приемки:** Access Token (JWT) имеет время жизни не более 15 минут. Refresh Token хранится только в httpOnly cookie и имеет время жизни не более 7 дней. При выходе из системы Refresh Token отзывается.

---

#### **2. Защита данных (хранимых и передаваемых)**

**2.1. Требование:** Вся передача данных между клиентом и сервером, а также между внутренними сервисами должна быть зашифрована.
*   **Критерий приемки:** Все эндпоинты доступны только по протоколу **HTTPS (TLS 1.2+)**. Любые HTTP-запросы автоматически перенаправляются на HTTPS. Внутренние вызовы между микросервисами используют mTLS.

**2.2. Требование:** Конфиденциальные данные должны быть зашифрованы при хранении.
*   **Критерий приемки:**
    *   Персональные данные (ФИО, email) в базе данных шифруются на уровне приложения с использованием российского алгоритма **ГОСТ 34.12-2015 (Кузнечик)**.
    *   Исходный код и документы в файловом хранилище шифруются с использованием AES-256 перед записью на диск.
    *   Ключи шифрования хранятся в специализированном сервисе (HashiCorp Vault или российский аналог), а не в коде приложения.

**2.3. Требование:** Система должна быть защищена от внедрения SQL-команд.
*   **Критерий приемки:** В коде приложения отсутствуют строковые конкатенации для формирования SQL-запросов. Используются только параметризованные запросы (Prepared Statements) или ORM. Отчет статического анализатора кода (SAST) не содержит уязвимостей категории "SQL Injection".

---

#### **3. Безопасность приложения**

**3.1. Требование:** Все входящие данные от пользователей должны быть валидированы.
*   **Критерий приемки:** Реализована валидация на стороне сервера для всех полей ввода (тип данных, длина, допустимые символы). Попытка передать в поле `username` SQL-команду или HTML-тег приводит к ошибке валидации без выполнения кода.

**3.2. Требование:** Защитить приложение от межсайтовой подделки запроса (CSRF).
*   **Критерий приемка:** Для всех state-changing операций (POST, PUT, DELETE) требуется наличие и проверка CSRF-токена. Автоматизированные тесты подтверждают, что запрос без валидного токена отклоняется с ошибкой 403.

**3.3. Требование:** Реализовать безопасные заголовки HTTP.
*   **Критерий приемки:** Все HTTP-ответы содержат заголовки безопасности:
    *   `Content-Security-Policy: default-src 'self'`
    *   `X-Content-Type-Options: nosniff`
    *   `X-Frame-Options: DENY`
    *   `Strict-Transport-Security: max-age=31536000; includeSubDomains`
    Проверка осуществляется с помощью сканера безопасности или браузерных инструментов.

---

#### **4. Аудит и мониторинг**

**4.1. Требование:** Все критичные события в системе должны регистрироваться.
*   **Критерий приемки:** В логи приложения в структурированном формате (JSON) записываются события: успешные и неудачные входы, изменение прав доступа, создание/удаление проектов, загрузка/скачивание файлов объемом >10 МБ. Логи включают метку времени, идентификатор пользователя (ID) и IP-адрес.

**4.2. Требование:** Логи должны быть защищены от модификации.
*   **Критерий приемки:** Настройки логирования не могут быть изменены в рантайме без перезапуска приложения. Файлы логов передаются в централизованную систему (например, ELK) с минимальной задержкой. Прямой доступ к файлам логов на сервере приложения имеют только назначенные администраторы.

---

#### **5. Резервное копирование и восстановление**

**5.1. Требование:** Обеспечить регулярное резервное копирование всех критичных данных.
*   **Критерий приемки:**
    *   Реализованы автоматические ежедневные полные бэкапы и инкрементальные бэкапы каждый час для баз данных и файлового хранилища.
    *   Резервные копии шифруются и хранятся в географически удаленном российском ЦОД.
    *   Периодически (не реже 1 раза в квартал) проводится процедура тестового восстановления из бэкапа, которая документируется.

**5.2. Требование:** Ключи шифрования и секреты приложения должны быть отделены от кода и их резервные копии должны храниться безопасно.
*   **Критерий приемки:** Все секреты (ключи шифрования, API-ключи для внешних сервисов) хранятся только в Vault. Доступ к Vault строго регламентирован. Существует процедура аварийного восстановления мастер-ключа Vault, хранящегося в сейфе у CISO.