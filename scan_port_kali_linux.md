
---

### **Практическая работа №3: Сканирование сетей в Kali Linux**

**Цель работы:** Научиться устанавливать и использовать основные инструменты для сканирования сетей, идентификации активных хостов и определения запущенных сервисов.

**Время выполнения:** 3 часа
**Уровень сложности:** Начальный

**ВАЖНОЕ ПРЕДУПРЕЖДЕНИЕ:**
Проводите сканирование **ТОЛЬКО** в собственной лабораторной среде или против целей, на которые имеете письменное разрешение. Несанкционированное сканирование является нарушением закона.

---

### **Часть 1: Подготовка рабочего окружения**

#### **Шаг 1.1: Обновление системы**
Перед установкой инструментов обновите систему:
```bash
sudo apt update
sudo apt upgrade -y
```

#### **Шаг 1.2: Установка необходимых пакетов**
Установите базовые утилиты, которые могут понадобиться:
```bash
sudo apt install git curl wget build-essential python3-pip -y
```

---

### **Часть 2: Установка и использование Nmap**

**Nmap** ("Network Mapper") — основной инструмент для сканирования сетей.

#### **Шаг 2.1: Проверка установки Nmap**
В Kali Linux Nmap обычно предустановлен. Проверьте:
```bash
nmap --version
```
Если не установлен:
```bash
sudo apt install nmap -y
```

#### **Шаг 2.2: Базовое сканирование сети**
Определите свою сеть:
```bash
ip addr show
```
Выполните ping-сканирование для поиска активных хостов:
```bash
sudo nmap -sn 192.168.1.0/24
```
*Замечание:* Замените `192.168.1.0/24` на вашу сеть.

#### **Шаг 2.3: Определение операционной системы**
Сканируйте конкретный хост для определения ОС:
```bash
sudo nmap -O 192.168.1.100
```

#### **Шаг 2.4: Полное сканирование портов**
Выполните comprehensive-сканирование:
```bash
sudo nmap -sS -sV -sC -A -O -p- 192.168.1.100
```
**Разбор параметров:**
- `-sS` — SYN scan (полуоткрытое сканирование)
- `-sV` — определение версий сервисов
- `-sC` — запуск Nmap Scripting Engine
- `-A` — агрессивное сканирование (OS detection, version detection, script scanning)
- `-p-` — все порты (1-65535)

---

### **Часть 3: Установка и использование Masscan**

**Masscan** — самый быстрый сканер портов, оптимален для больших сетей.

#### **Шаг 3.1: Установка Masscan**
```bash
sudo apt install masscan -y
```

#### **Шаг 3.2: Быстрое сканирование портов**
```bash
sudo masscan 192.168.1.0/24 -p1-1000 --rate=1000
```
**Параметры:**
- `--rate=1000` — количество пакетов в секунду
- `-p1-1000` — диапазон портов

---

### **Часть 4: Установка и использование Zmap**

**Zmap** — быстрый сканер для интернет-исследований.

#### **Шаг 4.1: Установка Zmap**
```bash
sudo apt install zmap -y
```

#### **Шаг 4.2: Сканирование конкретного порта**
Поиск хостов с открытым портом 80:
```bash
sudo zmap -p 80 192.168.1.0/24
```

---

### **Часть 5: Установка дополнительных инструментов**

#### **Шаг 5.1: Установка Netdiscover**
Для обнаружения хостов в локальной сети:
```bash
sudo apt install netdiscover -y
```
Использование:
```bash
sudo netdiscover -r 192.168.1.0/24
```

#### **Шаг 5.2: Установка Hping3**
Для продвинутого тестирования сетей:
```bash
sudo apt install hping3 -y
```
Пример TCP-сканирования:
```bash
sudo hping3 -S -p 80 192.168.1.100
```

#### **Шаг 5.3: Установка Dmitry**
Простой инструмент для сбора информации:
```bash
sudo apt install dmitry -y
```
Использование:
```bash
dmitry -p 192.168.1.100
```

---

### **Часть 6: Практические задания**

#### **Задание 6.1: Создание карты сети**
1. Определите диапазон вашей сети
2. Найдите все активные хосты
3. Составьте таблицу:
```
IP-адрес | MAC-адрес | Производитель | Открытые порты
```

#### **Задание 6.2: Анализ веб-сервера**
Если найден веб-сервер (порт 80/443), выполните:
```bash
nmap -sV --script http-enum,http-headers 192.168.1.100 -p 80,443
```

#### **Задание 6.3: Сравнение скорости сканирования**
Сравните скорость работы разных сканеров:
```bash
time nmap -p1-1000 192.168.1.100
time masscan -p1-1000 192.168.1.100 --rate=1000
```

---

### **Часть 7: Создание скриптов для автоматизации**

#### **Скрипт 7.1: Базовое сканирование**
Создайте файл `basic_scan.sh`:
```bash
#!/bin/bash
echo "=== Базовое сканирование сети ==="
read -p "Введите сеть (например, 192.168.1.0/24): " network

echo "1. Поиск активных хостов..."
nmap -sn $network

echo "2. Быстрое сканирование портов..."
nmap -F $network
```
Сделайте исполняемым и запустите:
```bash
chmod +x basic_scan.sh
./basic_scan.sh
```

#### **Скрипт 7.2: Детальное сканирование**
Создайте файл `detailed_scan.sh`:
```bash
#!/bin/bash
echo "=== Детальное сканирование хоста ==="
read -p "Введите IP-адрес: " target

echo "Сканирую хост $target..."
nmap -sS -sV -sC -A -O -p- $target -oN scan_results.txt

echo "Результаты сохранены в scan_results.txt"
```

---

### **Часть 8: Анализ результатов и отчетность**

#### **Шаг 8.1: Форматы вывода Nmap**
Сохраняйте результаты в разных форматах:
```bash
nmap -A 192.168.1.100 -oN normal.txt    # Обычный текст
nmap -A 192.168.1.100 -oX xml_output.xml # XML
nmap -A 192.168.1.100 -oG grepable.txt  # Grep-формат
```

#### **Шаг 8.2: Структура отчета**
Создайте отчет со следующей структурой:
1. **Цель сканирования**
2. **Методология**
3. **Обнаруженные хосты**
4. **Открытые порты и сервисы**
5. **Потенциальные уязвимости**
6. **Рекомендации**

---

### **Часть 9: Решение проблем**

#### **Проблема: "nmap: command not found"**
**Решение:**
```bash
sudo apt update && sudo apt install nmap -y
```

#### **Проблема: Недостаточно привилегий**
**Решение:** Используйте sudo:
```bash
sudo nmap -sS target
```

#### **Проблема: Файрвол блокирует сканирование**
**Решение:** Используйте разные техники:
```bash
nmap -sN target    # NULL scan
nmap -sF target    # FIN scan
nmap -sX target    # Xmas scan
```

---

### **Итоговое задание**

**Задача:** Проведите полное сканирование вашей лабораторной сети и создайте подробный отчет.

**Что должно быть в отчете:**
1. Список всех активных хостов
2. Для каждого хоста — открытые порты и версии сервисов
3. Предполагаемые операционные системы
4. Рекомендации по безопасности для каждого обнаруженного сервиса
5. Скриншоты работы инструментов

**Критерии оценки:**
- ✓ Правильность установки инструментов
- ✓ Корректность использования параметров сканирования
- ✓ Полнота обнаруженной информации
- ✓ Качество составленного отчета
- ✓ Понимание полученных результатов

**Дополнительные рекомендации:**
- Регулярно обновляйте базы данных Nmap: `sudo nmap --script-updatedb`
- Изучайте новые скрипты NSE: `ls /usr/share/nmap/scripts/`
- Практикуйтесь на специально созданных лабораториях (Metasploitable, DVWA)

Эта практическая работа даст вам solid foundation в области сетевого сканирования — фундаментального навыка для любого специалиста по кибербезопасности.


---

### **Практическая работа: Техники сканирования и уклонение от систем обнаружения**

**Цель работы:** Освоить продвинутые техники сетевого сканирования и методы обхода систем обнаружения вторжений (IDS/IPS).

**Время выполнения:** 3 часа
**Уровень сложности:** Продвинутый

**ВАЖНОЕ ПРЕДУПРЕЖДЕНИЕ:**
Используйте эти техники ТОЛЬКО в контролируемой лабораторной среде или с явного разрешения владельца сети.

---

### **Часть 1: Подготовка лабораторной среды**

#### **Шаг 1.1: Установка необходимых инструментов**
```bash
# Обновление системы
sudo apt update && sudo apt upgrade -y

# Основные инструменты сканирования
sudo apt install nmap masscan hping3 dnsutils -y

# Инструменты для работы с прокси
sudo apt install proxychains4 tor -y

# Дополнительные утилиты
sudo apt install netcat-openbsd tcpdump wireshark -y

# Python-библиотеки
pip3 install requests socks
```

#### **Шаг 1.2: Настройка тестовых целей**
Создаем простой веб-сервер для тестирования:
```bash
# На целевой машине (разрешенной для сканирования)
python3 -m http.server 8080 &
nc -lvnp 9999 &
```

---

### **Часть 2: Техники TCP-сканирования**

#### **Шаг 2.1: TCP SYN Scan (Stealth Scan)**
**Объяснение:** Отправляется SYN-пакет, анализируется ответ. Не завершает трехстороннее рукопожатие.
```bash
# Базовый SYN scan
sudo nmap -sS 192.168.1.100 -p 80,443,22

# С дополнительными опциями
sudo nmap -sS -T4 --min-rate 100 192.168.1.100 -p1-1000
```
**Параметры:**
- `-T4` — агрессивный тайминг
- `--min-rate 100` — минимум 100 пакетов в секунду

#### **Шаг 2.2: TCP Connect Scan**
**Объяснение:** Полное трехстороннее рукопожатие. Более заметный, но надежный.
```bash
sudo nmap -sT 192.168.1.100 -p 21,22,80,443
```

#### **Шаг 2.3: TCP ACK Scan**
**Объяснение:** Определяет состояние фильтрации firewall.
```bash
sudo nmap -sA 192.168.1.100 -p 80
sudo hping3 -A 192.168.1.100 -p 80 -c 3
```

#### **Шаг 2.4: TCP Window Scan**
**Объяснение:** Использует особенности реализации TCP-окна.
```bash
sudo nmap -sW 192.168.1.100 -p 75-85
```

---

### **Часть 3: Специальные и UDP техники**

#### **Шаг 3.1: Xmas Scan**
**Объяснение:** Устанавливает флаги FIN, PSH и URG — как "рождественская елка".
```bash
sudo nmap -sX 192.168.1.100 -p 22,80,443
sudo hping3 -F -P -U 192.168.1.100 -p 80 -c 2
```

#### **Шаг 3.2: FIN Scan**
**Объяснение:** Отправляет только FIN-пакет.
```bash
sudo nmap -sF 192.168.1.100 -p 79,81,113
```

#### **Шаг 3.3: NULL Scan**
**Объяснение:** Отправляет пакет без установленных флагов.
```bash
sudo nmap -sN 192.168.1.100 -p 75-85
```

#### **Шаг 3.4: UDP Scan**
**Объяснение:** Медленное, но важное сканирование UDP-портов.
```bash
sudo nmap -sU --min-rate 10 192.168.1.100 -p 53,67,68,69,123,161
```

---

### **Часть 4: Техники уклонения от обнаружения**

#### **Шаг 4.1: Фрагментация пакетов**
**Объяснение:** Разбивает пакеты на мелкие фрагменты для обхода простых IDS.
```bash
# Фрагментация в Nmap
sudo nmap -sS -f 192.168.1.100 -p 80,443

# Максимальная фрагментация
sudo nmap -sS -f -f --mtu 8 192.168.1.100 -p 80

# Фрагментация в hping3
sudo hping3 -S -f -p 80 192.168.1.100 -c 3
```

#### **Шаг 4.2: Изменение размера пакетов**
```bash
sudo nmap -sS --data-length 50 192.168.1.100 -p 80
sudo nmap -sS --data-length 1000 192.168.1.100 -p 80
```

#### **Шаг 4.3: Спуфинг MAC-адреса**
```bash
# Временное изменение MAC-адреса
sudo macchanger -r eth0

# Спуфинг в hping3
sudo hping3 -S -p 80 --spoof 192.168.1.50 192.168.1.100
```

#### **Шаг 4.4: Медленное сканирование**
```bash
# Очень медленное сканирование
sudo nmap -sS -T0 --scan-delay 5s 192.168.1.100 -p1-100

# Случайные задержки
sudo nmap -sS -T2 --max-scan-delay 10s 192.168.1.100 -p1-1000
```

---

### **Часть 5: Работа через прокси и TOR**

#### **Шаг 5.1: Настройка Proxychains**
Редактируем конфигурационный файл:
```bash
sudo nano /etc/proxychains4.conf
```
Добавляем в конец файла:
```
socks4 127.0.0.1 9050
http 192.168.1.200 8080
```

#### **Шаг 5.2: Запуск TOR**
```bash
sudo systemctl start tor
sudo systemctl status tor
```

#### **Шаг 5.3: Сканирование через прокси**
```bash
# Через TOR
proxychains4 nmap -sS -T2 192.168.1.100 -p 80,443

# Через HTTP прокси
proxychains4 nmap -sT --proxy http://192.168.1.200:8080 192.168.1.100 -p 22,80
```

#### **Шаг 5.4: Сканирование через цепочку прокси**
```bash
# Многоуровневое проксирование
proxychains4 -f /etc/proxychains4.conf nmap -sT -T1 192.168.1.100 -p 80
```

---

### **Часть 6: Дополнительные техники уклонения**

#### **Шаг 6.1: Случайное сканирование портов**
```bash
sudo nmap -sS --randomize-hosts --randomize-ports 192.168.1.100-150 -p1-1000
```

#### **Шаг 6.2: Source port spoofing**
```bash
sudo nmap -sS -g 53 192.168.1.100 -p 80    # Как будто от DNS
sudo nmap -sS -g 80 192.168.1.100 -p 443   # Как будто от веб-сервера
```

#### **Шаг 6.3: IP spoofing (требует особых условий)**
```bash
sudo nmap -S 192.168.1.50 -e eth0 192.168.1.100 -p 80
```

#### **Шаг 6.4: Decoy scanning**
```bash
# Сканирование с прикрытием (10 поддельных хостов)
sudo nmap -sS -D 192.168.1.20,192.168.1.30,192.168.1.40,ME 192.168.1.100 -p 80

# Случайные декои
sudo nmap -sS -D RND:10 192.168.1.100 -p1-100
```

---

### **Часть 7: Практические задания и сценарии**

#### **Задание 7.1: Обход базового файрвола**
Цель: определить правила фильтрации
```bash
#!/bin/bash
TARGET="192.168.1.100"
echo "=== Анализ фильтрации ==="

echo "1. SYN scan..."
nmap -sS $TARGET -p 75-85

echo "2. ACK scan..."
nmap -sA $TARGET -p 75-85

echo "3. FIN scan..."
nmap -sF $TARGET -p 75-85
```

#### **Задание 7.2: Сканирование с уклонением**
```bash
#!/bin/bash
TARGET="192.168.1.100"
echo "=== Сканирование с уклонением ==="

echo "1. Медленное фрагментированное сканирование..."
nmap -sS -f -T1 --scan-delay 2s $TARGET -p1-1000 -oN slow_scan.txt

echo "2. Сканирование через TOR..."
proxychains4 nmap -sT -T2 $TARGET -p 80,443,22 -oN tor_scan.txt
```

#### **Задание 7.3: Сравнение техник**
Создайте таблицу сравнения:

| Техника | Скорость | Заметность | Надежность | Применение |
|---------|----------|------------|------------|------------|
| SYN Scan | Высокая | Низкая | Высокая | Основное сканирование |
| Connect Scan | Средняя | Высокая | Очень высокая | Когда SYN недоступен |
| FIN Scan | Высокая | Низкая | Средняя | Обход простых файрволов |
| Xmas Scan | Высокая | Низкая | Средняя | Тестирование IDS |

---

### **Часть 8: Мониторинг и обнаружение сканирования**

#### **Шаг 8.1: Настройка обнаружения**
На целевой машине:
```bash
# Мониторинг сети
sudo tcpdump -i any -n 'tcp[13] & 2 != 0'    # SYN пакеты
sudo tcpdump -i any -n 'tcp[13] & 1 != 0'    # FIN пакеты
```

#### **Шаг 8.2: Анализ логов**
```bash
# Просмотр логов
sudo tail -f /var/log/auth.log
sudo journalctl -f
```

---

### **Часть 9: Создание комплексного скрипта**

#### **Скрипт advanced_scanner.sh**
```bash
#!/bin/bash

TARGET=$1
INTERFACE="eth0"

echo "=== Продвинутое сканирование $TARGET ==="

# Проверка доступности
echo "[1] Проверка доступности..."
ping -c 2 $TARGET

# Быстрое SYN сканирование основных портов
echo "[2] Быстрое SYN сканирование..."
nmap -sS -T4 --min-rate 500 $TARGET -p1-1000 -oN fast_scan.txt

# Медленное скрытое сканирование
echo "[3] Скрытое сканирование..."
nmap -sS -f -T1 --scan-delay 1s --randomize-hosts $TARGET -p1-1000 -oN stealth_scan.txt

# Специальные техники
echo "[4] Специальные техники..."
nmap -sF -sX -sN $TARGET -p 75-85 -oN special_scans.txt

# UDP сканирование ключевых портов
echo "[5] UDP сканирование..."
nmap -sU --min-rate 10 $TARGET -p 53,67,68,69,123,161 -oN udp_scan.txt

echo "Сканирование завершено. Результаты в файлах *.txt"
```

Запуск:
```bash
chmod +x advanced_scanner.sh
./advanced_scanner.sh 192.168.1.100
```

---
