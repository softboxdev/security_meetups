
---

### Тест: **Прямой (Forward) vs Обратный (Reverse) Прокси**

**Инструкция:** Выберите один или несколько правильных вариантов ответа для каждого вопроса. Результаты можно направить в чат или на почту soft.box.development@gmail.com

#### Часть 1: Основные концепции (5 вопросов)

**1. Главное концептуальное отличие между прямым и обратным прокси заключается в том, что:**
    а) Прямой прокси скрывает клиента, а обратный — сервер.
    б) Прямой прокси представляет интересы **клиента** перед серверами, а обратный представляет интересы **серверов** перед клиентами.
    в) Прямой прокси используется для кэширования, а обратный — для балансировки.
    г) Они технически устроены совершенно по-разному.

**2. Кто НАСТРАИВАЕТ использование прямого прокси в своей системе или браузере?**
    а) Администратор серверной инфраструктуры.
    б) Конечный пользователь или администратор его сети.
    в) Владелец веб-сайта.
    г) Обратный прокси автоматически перенаправляет трафик на прямой.

**3. Клиент, подключающийся к сайту за обратным прокси:**
    а) Обязательно должен знать его IP-адрес и порт.
    б) Может даже не подозревать о его существовании, так как обращается к обычному адресу сайта.
    в) Должен использовать специальный заголовок `X-Reverse-Proxy`.
    г) Всегда видит в ответе заголовок `Via: reverse-proxy`.

**4. Какой заголовок HTTP прокси-сервер чаще всего добавляет, чтобы сообщить бэкенду реальный IP-адрес исходного клиента?**
    а) `X-Client-IP`
    б) `X-Forwarded-For`
    в) `Via`
    г) `Proxy-Authorization`

**5. Функция «SSL/TLS терминация» (расшифровка HTTPS трафика) наиболее характерна для:**
    а) Прямого прокси в корпоративной сети.
    б) Обратного прокси на границе сети перед веб-серверами.
    в) Она в равной степени применяется в обоих типах.
    г) Это функция маршрутизатора, а не прокси.

#### Часть 2: Сценарии применения (5 вопросов)

**Определите, какой тип прокси (Прямой, Обратный или оба) лучше всего подходит для описанного сценария.**

**6. Сотрудники компании выходят в интернет через единый сервер, который блокирует доступ к социальным сетям и кэширует часто запрашиваемые файлы.**
    а) Прямой прокси.
    б) Обратный прокси.
    в) Оба типа.
    г) Ни один из типов.

**7. Высоконагруженный сайт `example.com` распределяет входящие запросы пользователей между 10 одинаковыми серверами с приложением.**
    а) Прямой прокси.
    б) Обратный прокси.
    в) Оба типа.
    г) Ни один из типов.

**8. Пользователь хочет получить доступ к веб-сайту, который заблокирован в его стране по IP-адресу.**
    а) Прямой прокси (или VPN).
    б) Обратный прокси.
    в) Оба типа.
    г) Маршрутизатор.

**9. Веб-приложение хочет защитить свои внутренние серверы от прямого доступа из интернета и проводить первичную проверку запросов на атаки (WAF).**
    а) Прямой прокси.
    б) Обратный прокси.
    в) Оба типа.
    г) Фаервол.

**10. Для доступа к корпоративному порталу снаружи используется адрес `portal.company.com`. Запросы на этот адрес перенаправляются на внутренние серверы в зависимости от пути URL (`/api/` → к одним серверам, `/static/` → к другим).**
    а) Прямой прокси.
    б) Обратный прокси.
    в) Оба типа.
    г) DNS-сервер.

#### Часть 3: Работа с диаграммами и заголовками (5 вопросов)

**11. Посмотрите на диаграмму для Прямого прокси. Что делает прокси на этапе «Анализ ответа», прежде чем передать его клиенту? (Выберите ВСЕ подходящие варианты)**
    а) Кэширование.
    б) Балансировку нагрузки между бэкендами.
    в) Сканирование антивирусом.
    г) SSL терминацию.

**12. Посмотрите на диаграмму для Обратного прокси. Какую из перечисленных функций он НЕ выполняет на этапе «Функции обратного прокси»?**
    а) TLS-терминация.
    б) Аутентификацию пользователя на стороне клиента.
    в) Маршрутизацию (на основе URL).
    г) Балансировку нагрузки.

**13. В запросе от Прямого прокси к Целевому серверу присутствует заголовок `X-Forwarded-For: [IP Клиента]`. Зачем он нужен?**
    а) Чтобы целевой сервер мог идентифицировать и заблокировать прокси.
    б) Чтобы целевой сервер знал реальный IP-адрес исходного клиента для логирования или геолокации.
    в) Это обязательный заголовок для работы протокола HTTP.
    г) Чтобы прокси мог аутентифицироваться на целевом сервере.

**14. В конфигурации обратного прокси Nginx часто используется директива `proxy_set_header Host $host;`. Что она делает?**
    а) Сохраняет оригинальный заголовок `Host` из запроса клиента при пересылке на бэкенд.
    б) Заменяет заголовок `Host` на адрес бэкенд-сервера.
    в) Удаляет заголовок `Host` для безопасности.
    г) Нужна для работы прямого прокси.

**15. Какой метод HTTP используется клиентом для установки туннеля через прямой прокси к HTTPS-серверу?**
    а) `GET`
    б) `TUNNEL`
    в) `CONNECT`
    г) `FORWARD`




#### **Часть 4: Углубленные технические детали (5 вопросов)**

**1. В контексте обратного прокси, что означает фраза "он выступает в роли единой точки входа (single entry point)"?**
    а) Все внешние клиенты подключаются только к нему, а он уже решает, как и куда направить запрос внутри инфраструктуры.
    б) Он требует от всех клиентов использования единого логина и пароля.
    в) Он шифрует весь трафик одним SSL-сертификатом.
    г) Он ограничивает подключение только с одного IP-адреса.

**2. Какой механизм позволяет "прозрачному прокси" (transparent proxy) перехватывать трафик без настройки на стороне клиента?**
    а) Изменение DNS-записей на стороне клиента.
    б) Настройка правил перенаправления трафика (например, через iptables) на сетевом шлюзе.
    в) Внедрение специального драйвера в операционную систему клиента.
    г) Использование протокола ICMP для перенаправления.

**3. Почему SSL-терминация на обратном прокси может повысить производительность бэкенд-серверов?**
    а) Прокси имеет более быстрые диски для записи логов.
    б) Прокси полностью блокирует вредоносные запросы, и бэкенды их не обрабатывают.
    в) Затратная операция расшифровки TLS/SSL выполняется один раз на прокси (возможно, на оборудовании с аппаратным ускорением), а на бэкенды приходит уже расшифрованный HTTP-трафик.
    г) Прокси кэширует зашифрованные ответы.

**4. Что из перечисленного является основной задачей Прямого прокси в корпоративной сети, но НЕ является задачей Обратного прокси?**
    а) Контроль и ограничение того, к каким *внешним* ресурсам могут обращаться внутренние пользователи.
    б) Балансировка нагрузки между внутренними серверами.
    в) Кэширование статического контента.
    г) Добавление заголовка `X-Forwarded-For`.

**5. Какой HTTP-код статуса вернет прямой прокси, если клиент не предоставил корректные учетные данные для аутентификации на самом прокси?**
    а) `401 Unauthorized`
    б) `407 Proxy Authentication Required`
    в) `403 Forbidden`
    г) `408 Request Timeout`

#### **Часть 5: Сценарии архитектуры и безопасности (5 вопросов)**

**6. У вас есть три веб-сервера с одним приложением и общим хранилищем файлов. Пользователи жалуются на медленную загрузку картинок. Вы решаете вынести обслуживание статических файлов (картинки, CSS, JS) на отдельный специализированный сервер или CDN. Какой функцией обратного прокси вы воспользуетесь для этого?**
    а) SSL Termination
    б) Контентная маршрутизация (Content-based routing)
    в) Балансировка нагрузки методом round-robin
    г) Gzip-сжатие

**7. Вы замечаете, что один из бэкенд-серверов за обратным прокси начал медленно отвечать и возвращать ошибки 500. Как должна повести себя "умная" конфигурация обратного прокси?**
    а) Немедленно отключить этот сервер из пула балансировки и перенаправлять трафик только на здоровые серверы.
    б) Увеличить таймаут ожидания ответа от этого сервера.
    в) Начать рассылку уведомлений администраторам.
    г) Отправлять всем клиентам, запросившим этот сервер, извинительную страницу.

**8. Для чего в цепочке "Клиент → Прямой прокси → Сайт" может использоваться заголовок `Proxy-Authorization`?**
    а) Для аутентификации клиента на Целевом сайте (например, в API).
    б) Для аутентификации клиента на самом Прямом прокси-сервере (чтобы доказать право выхода в интернет).
    в) Для аутентификации Прямого прокси на Целевом сайте.
    г) Для аутентификации сессии между Клиентом и Прямым прокси.

**9. Вы разрабатываете мобильное приложение, которое должно общаться с вашим API. Прямой доступ к серверам API из интернета закрыт. Как правильно организовать доступ?**
    а) Попросить пользователей настроить в телефоне прямой прокси с адресом вашего API-сервера.
    б) Разместить обратный прокси (например, `api.yourcompany.com`) в демилитаризованной зоне (DMZ), который будет перенаправлять запросы на внутренние серверы API.
    в) Открыть порты бэкенд-серверов API напрямую в интернет.
    г) Использовать только push-уведомления.

**10. Какую проблему решает механизм "Keep-Alive" на обратном прокси в контексте соединений с бэкенд-серверами?**
    а) Шифрование трафика между прокси и бэкендом.
    б) Снижение накладных расходов за счет повторного использования уже установленных TCP-соединений к бэкендам вместо создания нового на каждый запрос.
    в) Поддержание сессии аутентификации пользователя.
    г) Обеспечение отказоустойчивости бэкендов.

#### **Часть 6: Анализ и сравнение (5 вопросов)**

**11. Посмотрите на логи веб-сервера приложения. В них вы видите множество запросов с одного и того же IP-адреса (например, `10.0.0.1`). При этом вы знаете, что перед этим сервером стоит обратный прокси. О чем это говорит?**
    а) На ваш сайт идет DDoS-атака с адреса `10.0.0.1`.
    б) IP-адрес `10.0.0.1` — это адрес обратного прокси. Все внешние запросы приходят через него.
    в) Настройки обратного прокси не передают заголовок `X-Forwarded-For`.
    г) Ваш сервер приложения неправильно сконфигурирован.

**12. Вам нужно предоставить доступ к внутреннему инструменту мониторинга (например, Grafana) только для сотрудников из офиса. Инструмент работает на внутреннем сервере. Какое решение будет наиболее простым и безопасным?**
    а) Настроить прямой прокси на рабочей станции сотрудника и добавить правило доступа только к этому серверу.
    б) Вынести инструмент в публичный интернет с собственным доменом.
    в) Настроить VPN для удаленного доступа в офисную сеть.
    г) Использовать обратный прокси с аутентификацией (например, Basic Auth), который будет доступен из интернета и перенаправлять запросы на внутренний сервер.

**13. Какие из этих утверждений о КЭШИРОВАНИИ являются верными?**
    а) **Прямой прокси** кэширует контент от *разных* сайтов для *многих* внутренних пользователей (снижая внешний трафик).
    б) **Обратный прокси** кэширует контент *своего* сайта (сайтов) для *многих* внешних пользователей (снижая нагрузку на бэкенды).
    в) Кэширование — это исключительная функция прямого прокси.
    г) Кэширование — это исключительная функция обратного прокси.

**14. Что из перечисленного НЕ является типичной функцией или преимуществом обратного прокси?**
    а) Возможность "зашить" статический контент (например, старую версию сайта) при падении всех бэкенд-серверов.
    б) Сжатие (gzip) ответов перед отправкой клиенту для экономии bandwidth.
    в) Смена User-Agent в запросах от клиента для обхода блокировок.
    г) Ограничение скорости запросов (rate limiting) с одного IP-адреса клиента.

**15. Представьте архитектуру: `Интернет-клиент -> Облачный балансировщик нагрузки (AWS ALB) -> Группа веб-серверов`. К какому типу прокси по своей сути относится облачный балансировщик нагрузки (ALB)?**
    а) Это прямой прокси, так как представляет клиента.
    б) Это обратный прокси, так как представляет группу серверов.
    в) Это не прокси, а маршрутизатор.
    г) Это гибридный прокси, выполняющий обе роли.

---

### Ответы и пояснения

**Часть 1:**
1.  **б)** — Это ключевая идея: кто чьи интересы представляет.
2.  **б)** — Настройка прокси — ответственность стороны клиента.
3.  **б)** — Обратный прокси прозрачен для клиента, это "лицо" сайта.
4.  **б)** — Стандартный заголовок для передачи исходного IP.
5.  **б)** — Обратный прокси часто принимает HTTPS, расшифровывает и отправляет HTTP дальше на бэкенд, разгружая его.

**Часть 2:**
6.  **а) Прямой прокси.** — Классический пример корпоративного интернет-шлюза.
7.  **б) Обратный прокси.** — Это одна из его основных ролей — балансировщик нагрузки (Load Balancer).
8.  **а) Прямой прокси (или VPN).** — Пользователь настраивает прокси, чтобы выйти в сеть из-под другого IP.
9.  **б) Обратный прокси.** — Он выступает в роли защитного щита (иногда с WAF) для внутренней инфраструктуры.
10. **б) Обратный прокси.** — Контентная маршрутизация (routing based on URL path) — типичная задача обратного прокси.

**Часть 3:**
11. **а) и в)**. Прямой прокси анализирует ответ для кэширования и проверки безопасности. Балансировка (б) и SSL терминация (г) — это функции обратного прокси.
12. **б)**. Обратный прокси обычно не занимается аутентификацией на стороне *клиента* (это делают бэкенд-сервисы или специальные сервисы аутентификации). Он может проксировать запросы к таким сервисам.
13. **б)**. Именно для этого он и предназначен.
14. **а)**. Это важно, чтобы бэкенд-приложение, которое может зависеть от значения заголовка Host (виртуальные хосты, генерация ссылок), получило его в исходном виде.
15. **в)**. Метод `CONNECT` используется для создания TCP-туннеля через прокси, чаще всего для HTTPS.

**Часть 4:**
1.  **а)** — Это основная архитектурная роль обратного прокси: принимать все входящие запросы и распределять их.
2.  **б)** — Прозрачный прокси работает на сетевом уровне, перенаправляя трафик (например, с порта 80) на себя с помощью правил межсетевого экрана.
3.  **в)** — Это прямое следствие разделения обязанностей: прокси берет на себя ресурсоемкую криптографию.
4.  **а)** — Контроль исходящего трафика (что смотрят сотрудники) — ключевая задача корпоративного прямого прокси. Обратный прокси занимается входящим трафиком.
5.  **б)** — `407` — специальный код для требования аутентификации именно на прокси. `401` — для аутентификации на целевом веб-сервере.

**Часть 5:**
6.  **б)** — Контентная маршрутизация позволяет направить запросы, путь которых начинается с `/images/` или `/static/`, на отдельный сервер или CDN.
7.  **а)** — Это функция health check и автоматического исключения неисправных нод из пула балансировки.
8.  **б)** — `Proxy-Authorization` используется клиентом для предъявления учетных данных (логин/пароль) прокси-серверу, через который он выходит.
9.  **б)** — Стандартный и безопасный паттерн: обратный прокси в DMZ выступает защищенным фасадом для внутренних сервисов.
10. **б)** — Keep-Alive соединения между прокси и бэкендом — важная оптимизация производительности, избегающая постоянного трехстороннего рукопожатия TCP.

**Часть 6:**
11. **б) и в)** — Это классическая ситуация. Бэкенд видит только IP прокси (б). Если заголовок `X-Forwarded-For` не настроен (в), логи теряют информацию о реальных клиентах.
12. **в)** — VPN — наиболее безопасный и правильный способ доступа к внутренним ресурсам. Вариант (г) с обратным прокси менее безопасен, так как выносит точку входа в интернет.
13. **а) и б)** — Оба утверждения верны. Оба типа прокси могут кэшировать, но в разных целях и для разных аудиторий.
14. **в)** — Смена User-Agent — это характерная задача для *прямого* прокси, используемого для обхода ограничений. Для обратного прокси это не типично.
15. **б)** — Облачный балансировщик нагрузки (ALB, NLB, GCLB) — это классический пример обратного прокси в облачной экосистеме. Он принимает запросы от клиентов и распределяет их между группой целевых серверов.